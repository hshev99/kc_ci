<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title></title>
<link href="/static/pc/css/style.css" type="text/css" rel="stylesheet" />
    <link rel="stylesheet" href="/static/pc/css/imgStyle.css" type="text/css" />
<script src="/static/pc/js/jquery-1.11.2.min.js" type="text/javascript"></script>
<script src="/static/pc/js/jquery.SuperSlide.2.1.1.js" type="text/javascript"></script>
<script language="javascript" src="/static/pc/js/PCASClass.js"></script>
    <script src="/static/pc/js/img.js" type="text/javascript"></script>
    <link rel="stylesheet" href="/static/pc/css/kalendae.css" type="text/css" charset="utf-8">
    <script src="/static/pc/js/kalendae.standalone.js" type="text/javascript"></script>
    <script>
        $(function () {
            var canvas = document.getElementById("container"),
                    context = canvas.getContext("2d"),
            //文件服务器地址
                    fileServer = null,
            //适配环境，随时修改事件名称
                    eventName = { down: "mousedown", move: "mousemove", up: "mouseup", click: "click" };
            //////////canvas尺寸配置
            var canvasConfig = {
                //容器canvas尺寸
                width: 400,
                height: 400,
                //原图放大/缩小
                zoom: 1,
                //图片对象
                img: null,
                //图片完整显示在canvas容器内的尺寸
                size: null,
                //图片绘制偏移，为了原图不移出框外，这个只能是负值or 0
                offset: { x: 0, y: 0 },
                //当前应用的滤镜
                filter: null
            }
            canvas.width = canvasConfig.width;
            canvas.height = canvasConfig.height;
            ///////////设置选择工具配置
            var config = {
                //图片选择框当前大小、最大大小、最小大小
                pickerSize: 100,
                minSize: 50,
                maxSize: 200,
                x: canvas.width / 2 - 100 / 2,
                y: canvas.height / 2 - 100 / 2
            };
            /////////////结果canvas配置
            var resCanvas = [$("#res1")[0].getContext("2d"), $("#res2")[0].getContext("2d"), $("#res3")[0].getContext("2d")];
            //结果canvas尺寸配置
            var resSize = [140, 100, 60]
            resSize.forEach(function (size, i) {
                $("#res" + (i + 1))[0].width = size;
                $("#res" + (i + 1))[0].height = size;
            });
            //////// 滤镜配置
            var filters = [];
            filters.push({
                name: "灰度", func: function (pixelData) {
                    //r、g、b、a
                    //灰度滤镜公式： gray=r*0.3+g*0.59+b*0.11
                    var gray;
                    for (var i = 0; i < canvasConfig.width * canvasConfig.height; i++) {
                        gray = pixelData[4 * i + 0] * 0.3 + pixelData[4 * i + 1] * 0.59 + pixelData[4 * i + 2] * 0.11;
                        pixelData[4 * i + 0] = gray;
                        pixelData[4 * i + 1] = gray;
                        pixelData[4 * i + 2] = gray;
                    }
                }
            });
            filters.push({
                name: "黑白", func: function (pixelData) {
                    //r、g、b、a
                    //黑白滤镜公式： 0 or 255
                    var gray;
                    for (var i = 0; i < canvasConfig.width * canvasConfig.height; i++) {
                        gray = pixelData[4 * i + 0] * 0.3 + pixelData[4 * i + 1] * 0.59 + pixelData[4 * i + 2] * 0.11;
                        if (gray > 255 / 2) {
                            gray = 255;
                        }
                        else {
                            gray = 0;
                        }
                        pixelData[4 * i + 0] = gray;
                        pixelData[4 * i + 1] = gray;
                        pixelData[4 * i + 2] = gray;
                    }
                }
            });
            filters.push({
                name: "反色", func: function (pixelData) {
                    for (var i = 0; i < canvasConfig.width * canvasConfig.height; i++) {
                        pixelData[i * 4 + 0] = 255 - pixelData[i * 4 + 0];
                        pixelData[i * 4 + 1] = 255 - pixelData[i * 4 + 1];
                        pixelData[i * 4 + 2] = 255 - pixelData[i * 4 + 2];
                    }
                }
            });
            filters.push({ name: "无", func: null });
            // 添加滤镜按钮
            filters.forEach(function (filter) {
                var button = $("<button>" + filter.name + "</button>");
                button.on(eventName.click, function () {
                    canvasConfig.filter = filter.func;
                    //重绘
                    draw(context, canvasConfig.img, canvasConfig.size);
                });
                $("#filters").append(button);
            });
            //下载生成的图片(只下载第一张)
            $("#download").on(eventName.click, function () {

                //将mime-type改为image/octet-stream，强制让浏览器直接download
                var _fixType = function (type) {
                    type = type.toLowerCase().replace(/jpg/i, 'jpeg');
                    var r = type.match(/png|jpeg|bmp|gif/)[0];
                    return 'image/' + r;
                };
                var saveFile = function (data, filename) {
                    var save_link = document.createElementNS('http://www.w3.org/1999/xhtml', 'a');
                    save_link.href = data;
                    save_link.download = filename;
                    var event = document.createEvent('MouseEvents');
                    event.initMouseEvent('click', true, false, window, 0, 0, 0, 0, 0, false, false, false, false, 0, null);
                    save_link.dispatchEvent(event);
                };
                var imgData = $("#res1")[0].toDataURL("png");
                imgData = imgData.replace(_fixType("png"), 'image/octet-stream');//base64
                saveFile(imgData, "头像created on" + new Date().getTime() + "." + "png");
            });
            //上传图片
            $("#upload").on(eventName.click, function () {
                var imgData = $("#res1")[0].toDataURL("png");
                imgData = imgData.replace(/^data:image\/(png|jpg);base64,/, "");
                if (!fileServer) {
                    'http://www.51huole.cn/img/portrait?uid=';
                }

                var blobBin = atob(imgData);
                var array = [];
                for (var i = 0; i < blobBin.length; i++) {
                    array.push(blobBin.charCodeAt(i));
                }
                var blob = new Blob([new Uint8Array(array)], { type: 'image/png' });
                var file = new File([blob], "userfile.png", { type: 'image/png' });
                var formdata = new FormData();
                formdata.append("userfile", file);
                $.ajax({
                    type: 'POST',
                    url: '../img/do_upload',
                    data: formdata,
                    processData: false,
                    contentType: false,
                    dataType: 'json',
                    success: function (msg) {
                        $("#uploadres").text(JSON.stringify(msg));
                        $("#rImg").attr("src",msg.results.img);
                    }
                });
            });
            //绑定选择图片事件
            $("#fileinput").change(function () {
                var file = this.files[0],
                        URL = (window.webkitURL || window.URL),
                        url = URL.createObjectURL(file),
                        img = new Image();
                img.src = url;
                img.onload = function () {
                    canvasConfig.img = img;
                    canvasConfig.size = getFixedSize(img, canvas);
                    draw(context, img, canvasConfig.size);
                    setPicker();
                }

            });
            //移动选择框
            //绑定鼠标在选择工具上按下的事件
            $("#picker").on(eventName.down, function (e) {
                e.stopPropagation();
                var start = { x: e.clientX, y: e.clientY, initX: config.x, initY: config.y };
                $("#canvasContainer").on(eventName.move, function (e) {
                    // 将x、y限制在框内
                    config.x = Math.min(Math.max(start.initX + e.clientX - start.x, 0), canvasConfig.width - config.pickerSize);
                    config.y = Math.min(Math.max(start.initY + e.clientY - start.y, 0), canvasConfig.height - config.pickerSize);
                    setPicker();
                })
            });
            //原图移动事件
            $("#container").on(eventName.down, function (e) {
                e.stopPropagation();
                var start = { x: e.clientX, y: e.clientY, initX: canvasConfig.offset.x, initY: canvasConfig.offset.y };
                var size = canvasConfig.size;
                $("#canvasContainer").on(eventName.move, function (e) {
                    // 将x、y限制在框内
                    // 坐标<0  当图片大于容器  坐标>容器-图片   否则不能移动
                    canvasConfig.offset.x = Math.max(Math.min(start.initX + e.clientX - start.x, 0), Math.min(canvasConfig.width - size.width * canvasConfig.zoom, 0));
                    canvasConfig.offset.y = Math.max(Math.min(start.initY + e.clientY - start.y, 0), Math.min(canvasConfig.height - size.height * canvasConfig.zoom, 0));
                    //重绘蒙版
                    draw(context, canvasConfig.img, canvasConfig.size);
                })
            });
            //改变选择框大小事件
            $("#resize").on(eventName.down, function (e) {
                e.stopPropagation();
                var start = { x: e.clientX, init: config.pickerSize };
                $("#canvasContainer").on(eventName.move, function (e) {
                    config.pickerSize = Math.min(Math.max(start.init + e.clientX - start.x, config.minSize), config.maxSize);
                    $("#picker").css({ width: config.pickerSize, height: config.pickerSize });
                    draw(context, canvasConfig.img, canvasConfig.size);
                })
            });
            $(document).on(eventName.up, function (e) {
                $("#canvasContainer").unbind(eventName.move);
            });
            //原图放大、缩小
            $("#bigger").on(eventName.click, function () {
                canvasConfig.zoom = Math.min(3, canvasConfig.zoom + 0.1);
                //重绘蒙版
                draw(context, canvasConfig.img, canvasConfig.size);
            });
            $("#smaller").on(eventName.click, function () {
                canvasConfig.zoom = Math.max(0.4, canvasConfig.zoom - 0.1);
                //重绘蒙版
                draw(context, canvasConfig.img, canvasConfig.size);
            });

            // 定位选择工具
            function setPicker() {
                $("#picker").css({
                    width: config.pickerSize + "px", height: config.pickerSize + "px",
                    top: config.y, left: config.x
                });
                //重绘蒙版
                draw(context, canvasConfig.img, canvasConfig.size);
            }
            //绘制canvas中的图片和蒙版
            function draw(context, img, size) {
                var pickerSize = config.pickerSize,
                        zoom = canvasConfig.zoom,
                        offset = canvasConfig.offset;
                context.clearRect(0, 0, canvas.width, canvas.height);
                context.drawImage(img, 0, 0, img.width, img.height, offset.x, offset.y, size.width * zoom, size.height * zoom);
                //绘制挖洞后的蒙版
                context.save();
                context.beginPath();
                pathRect(context, config.x, config.y, pickerSize, pickerSize);
                context.rect(0, 0, canvas.width, canvas.height);
                context.closePath();
                context.fillStyle = "rgba(255,255,255,0.9)";
                context.fill();
                context.restore();
                //绘制结果
                var imageData = context.getImageData(config.x, config.y, pickerSize, pickerSize)
                resCanvas.forEach(function (resContext, i) {
                    resContext.clearRect(0, 0, resSize[i], resSize[i]);
                    resContext.drawImage(canvas, config.x, config.y, pickerSize, pickerSize, 0, 0, resSize[i], resSize[i]);
                    //添加滤镜效果
                    if (canvasConfig.filter) {
                        var imageData = resContext.getImageData(0, 0, resSize[i], resSize[i]);
                        var temp = resContext.getImageData(0, 0, resSize[i], resSize[i]);// 有的滤镜实现需要temp数据
                        canvasConfig.filter(imageData.data, temp);
                        resContext.putImageData(imageData, 0, 0, 0, 0, resSize[i], resSize[i]);
                    }
                });
            }
            //逆时针用路径自己来绘制矩形，这样可以控制方向，以便挖洞
            // 起点x，起点y，宽度，高度
            function pathRect(context, x, y, width, height) {
                context.moveTo(x, y);
                context.lineTo(x, y + height);
                context.lineTo(x + width, y + height);
                context.lineTo(x + width, y);
                context.lineTo(x, y);
            }
            // 根据图片和canvas的尺寸，确定图片显示在canvas中的尺寸
            function getFixedSize(img, canvas) {
                var cancasRate = canvas.width / canvas.height,
                        imgRate = img.width / img.height, width = img.width, height = img.height;
                if (cancasRate >= imgRate && img.height > canvas.height) {
                    height = canvas.height;
                    width = imgRate * height;
                }
                else if (cancasRate < imgRate && img.width > canvas.width) {
                    width = canvas.width;
                    height = width / imgRate;
                }
                return { width: width, height: height };
            }
        });
    </script>
    <style type="text/css">
        .kalendae .k-calendar {width:252px;}
        .kalendae .k-days { width:252px;}
        .container .inner li{ width:30px; height:30px; text-align: center; line-height: 30px; font-size:16px; margin:3px;}
        .kalendae .k-header span {  width:30px;  height:30px; line-height: 30px;  }
        .kalendae .k-days span {  width:30px;  height:30px;  line-height:30px;  }
        .kalendae .k-header span {  width:30px;  height:30px; line-height: 30px;}
        .kalendae .k-title, .kalendae .k-header, .kalendae .k-days {  width:252px;}
        .kalendae { font-size:15px;}
        .kalendae .k-separator {height:291px;margin:5px 10px;}
    </style>
</head>

<body class="back">
<?php include "header.html";?>
<div id="main">
	<div class="wrap">
    	<div class="content">
        	<div class="infomation">
            	<div class="left" style="float: left; margin:0; position: static;">
                    <div class="top_list1">
                        <span>歌手列表</span>
                        <a href="#">[编辑]</a>
                    </div>
                    <div class="coll_list1">
                    	<ul>
                            <li style="margin-bottom:20px;"><a href=""><img src="/static/pc/images/coll2.jpg"/></a></li>
                        	<div>

                            </div>
                        </ul>
                    </div>
                </div>
                <div class="rightInfo">
                	<dl class="bd">
                    	<dt>账户资料</dt>
                        <dd>
                        	<table cellpadding="0" width="100%" cellspacing="0" border="0">
                            	<tr height="50" valign="middle">
                                	<td width="125"  align="right"><font style="color:#fa424c">*</font> 姓名</td>
                                    <td width="20">&nbsp;</td>
                                    <td><input type="text" class="input1" id="name" /></td>
                                </tr>
                                <tr height="50" valign="middle">
                                	<td width="125" align="right"><font style="color:#fa424c">*</font> 歌手类型</td>
                                    <td width="20">&nbsp;</td>
                                    <td>
                                        <input type="radio" name="gender" checked="checked" style="float: left; margin-top: 3px;"/> <span style="float: left; margin:0 10px 0 5px;">女歌手</span>
                                        <input type="radio" name="gender" style="float: left; margin-top: 3px;"/> <span style="float: left; margin:0 10px 0 5px;">男歌手</span>
                                        <input type="radio" name="gender" style="float: left; margin-top: 3px;"/> <span style="float: left; margin:0 10px 0 5px;">组合/乐队</span>
                                    </td>
                                </tr>
                                <tr height="50" valign="middle">
                                	<td width="125" align="right">手机号码</td>
                                    <td width="20">&nbsp;</td>
                                    <td id="phone" style="position: relative; z-index:111;">
                                        <div id="num_phone" style="float: left"></div>
                                        <a style="color:#fa424c; margin-left: 20px; float: left;">修改</a>
                                        <input type="text" id="modify" class="input1" style="position: absolute; z-index:99; left: 0; top:10px; display: none;" />
                                    </td>
                                </tr>
                                <tr height="50" valign="middle">
                                	<td width="125" align="right">邮箱</td>
                                    <td width="20">&nbsp;</td>
                                    <td>
                                    <input type="text" id="email_info" class="input1" />
                                    </td>
                                </tr>
                                <tr height="50" valign="middle">
                                	<td width="125" align="right">所在地</td>
                                    <td width="20">&nbsp;</td>
                                    <td id="home">
                                        <select class="address" id="province" name="province"></select>
                                        <select class="address" id="city" name="city"></select>
                                        <select class="address" id="area" name="area"></select>
                                    </td>
                                </tr>
                                <tr valign="middle">
                                	<td width="125" align="right" valign="top" style="line-height:50px;"><font style="color:#fa424c">*</font> 个人头像</td>
                                    <td width="20">&nbsp;</td>
                                    <td>
                                    <div class="imgInfo">
                                    选一张您喜欢的照片做头像吧(建议图片尺寸不小于200*200)。支持Jpeg和静态
Gif格式，大小不超过2M。
                                    </div>
                                    <div class="headImg">
                                    	<div class="img"><a href="javascript:;" onclick="$('#getImg').fadeIn()" ><img id="rImg" src="" /> </a></div>
                                        <div class="file"></div>
                                    </div>
                                    </td>
                                </tr>
                                <tr height="214" valign="middle">
                                	<td width="125" align="right" valign="top" style="line-height:90px;"><font style="color:#fa424c">*</font> 个人简介</td>
                                    <td width="20">&nbsp;</td>
                                    <td>
                                    <textarea class="textCon" id="texCon" placeholder="请输入个人简介，字数500字以内。">
</textarea>
                                    </td>
                                </tr>
                            </table>
                        </dd>
                    </dl>
                    <dl class="bd">
                    	<dt>歌手资料</dt>
                        <dd>
                        	<table cellpadding="0" width="100%" cellspacing="0" border="0">
                            	<tr valign="middle">
                                	<td width="125" valign="top" style="line-height:50px;" align="right"><font style="color:#fa424c">*</font> 歌手风格</td>
                                    <td width="20">&nbsp;</td>
                                    <td><p style="line-height:50px;">请在下列选项中选出最多三项作为您的个人风格标签。</p>
                                    	<div class="listUl" id="styleList">
                                        	<ul>

                                            </ul>
                                        </div>
                                    </td>
                                </tr>
                                <tr valign="middle">
                                	<td width="125" valign="top" style="line-height:90px;" align="right"><font style="color:#fa424c">*</font> 出场费用</td>
                                    <td width="20">&nbsp;</td>
                                    <td>
                                    <div class="cost" style="margin-top:25px;">
                                    	<span>现出场费用</span>
                                        <input type="text" id="cost" class="costText" />
                                        <span>万/场</span>
                                    </div>
                                    <div class="cost">
                                    	<span>原出场费用</span>
                                        <input type="text" id="history_cost" class="costText" />
                                        <span>万/场</span>
                                    </div>
                                    </td>
                                </tr>
                                <tr valign="middle" >
                                	<td width="125" valign="top" style="line-height:90px;" align="right"><font style="color:#fa424c">*</font> 档期</td>
                                    <td width="20">&nbsp;</td>
                                    <td>
                                    <div class="calenTwo" id="dd23">

                                    </div>
                                    <div class="notes" >
                                        <img src="/static/pc/images/sing7.jpg" width="14" height="14" /> &nbsp;无档期
                                    </div>
                                    </td>
                                </tr>
                                <tr valign="middle">
                                	<td width="125" valign="top" style="line-height:50px;" align="right">参加的活动</td>
                                    <td width="20">&nbsp;</td>
                                    <td><p style="line-height:50px;">请在下列选项中<span style="color:#fa424c;">选出您会参与的活动</span>，不选择则不出席。<font style="color:#fa424c">(全部不选择视为全部出席)</font></p>
                                    	<div class="listUl" id="typeList">
                                        	<ul>

                                            </ul>
                                        </div>
                                    </td>
                                </tr>
                                <tr valign="middle">
                                	<td width="125" valign="top" style="line-height:50px;" align="right"> 餐标</td>
                                    <td width="20">&nbsp;</td>
                                    <td><p style="line-height:50px;">请选择您的餐饮标准（元/日）<font style="color:#fa424c">(不选择视为全部接受)</font></p>
                                    	<div class="listUl" id="eat">
                                        	<ul>
                                            </ul>
                                        </div>
                                    </td>
                                </tr>
                                <tr valign="middle">
                                	<td width="125" valign="top" style="line-height:50px;" align="right"> 住宿</td>
                                    <td width="20">&nbsp;</td>
                                    <td><p style="line-height:50px;">请选择您的住宿标准 &nbsp;<font style="color:#fa424c">(不选择视为全部接受)</font></p>
                                    	<div class="listUl" id="hotel">
                                        	<ul>
                                            </ul>
                                        </div>
                                    </td>
                                </tr>
                                <tr valign="middle">
                                	<td width="125" valign="top" style="line-height:50px;" align="right"> 出行</td>
                                    <td width="20">&nbsp;</td>
                                    <td><p style="line-height:50px;">请选择您的出行标准 &nbsp;<font style="color:#fa424c">(不选择视为全部接受)</font></p>
                                    	<div class="listUl" id="car">
                                        	<ul>

                                            </ul>
                                            <ul style="margin-top:5px;">
                                            </ul>
                                            <ul style="margin-top:5px;">

                                            </ul>
                                            <ul style="margin-top:5px;">

                                            </ul>
                                        </div>
                                    </td>
                                </tr>
                                <tr valign="middle" style="margin-top: 10px;">
                                    <td width="125" valign="top" style="line-height:50px;" align="right">随行人数</td>
                                    <td width="20">&nbsp;</td>
                                    <td>
                                        <select class="person" id="person" name="person">
                                            <option>请选择随行人数</option>
                                            <script>
                                                for(var opti = 1; opti<=20; opti++){
                                                    document.write('<option>');
                                                    document.write(opti+'人');
                                                    document.write('</option>');
                                                }
                                            </script>
                                        </select>
                                    </td>
                                </tr>
                                <tr valign="middle">
                                	<td width="125" valign="top" style="line-height:50px;" align="right">其他要求</td>
                                    <td width="20">&nbsp;</td>
                                    <td><p style="line-height:50px;">请输入您的其他要求，不填写即为无，字数30字以内。</p>
                                    	<input type="text" class="other" id="other_text" />
                                    </td>
                                </tr>
                            </table>
                        </dd>
                    </dl>
                    <dl class="bd" style="margin-top:20px">
                        <dd>
                            <button id="butRad">保存修改</button>
                        </dd>
                    </dl>
                </div>
            </div>
        </div>
    </div> 
</div>
<div id="footer"></div>
<div id="getImg" style="position:fixed; z-index:999; left:0; top:0; padding-top:40px; width:100%; height:100%; background-color:rgba(0,0,0,.3); display:none;">
    <div style="margin:0 auto; width:652px; position:relative;">
        <div style="float:left; padding:10px; background-color:#fff; border-top:2px solid #fa424c;">
            <div class="tit_name">
                <span>头像设置</span>
                <a href="javascript:;" onclick="$('#getImg').fadeOut()">X</a>
            </div>
            <div class="but_box">
                <div class="new-contentarea tc"> <a href="javascript:void(0)" class="upload-img">
                    <label for="upload-file">上传图像</label>
                </a>
                    <input type="file" class="" name="upload-file" id="fileinput" />
                </div>
                <button id="bigger" class="Btnsty_peyton">放大</button>
                <button id="smaller" class="Btnsty_peyton">缩小</button>
            </div>
            <div id="canvasContainer">
                <canvas id="container"></canvas>
                <div id="picker">
                    <div id="resize"></div>
                </div>
            </div>
            <div class="imgRightHead">
                <div class="cropped">
                    <p style="float:left; width:160px; text-align:left; padding:5px 20px;">预览：</p>
                    <div class="content_can"><canvas id="res3"></canvas><p>60px*60px</p></div>
                    <div class="content_can"><canvas id="res2"></canvas><p>100px*100px</p></div>
                    <div class="content_can"><canvas id="res1"></canvas><p>140px*140px</p></div>
                    <button id="download" class="Btnsty_peyton_but">下载</button>
                    <button id="upload" class="Btnsty_peyton_but" onclick="$('#getImg').fadeOut()">确定</button>
                    <div id="uploadres" style="display: none"></div>
                </div>
            </div>
        </div>
    </div>
</div>

<script language="javascript" defer>
    new PCAS("province","city","area","所在省","所在市","所在区");
</script>
<script type="text/javascript">
    var uid="<?php echo $uid?>";
    $(function(){
       $.ajax({
           url:'../AddSinger/index?uid='+uid,
           type:'get',
           dataType:'json',
           success:function(data){
               var coll = '';
               for(var col = 0; col < data.results.length; col++){
                    coll+='<li><a href="coll_info?uid'+data.results[col].uid+'">'+data.results[col].name+'</a></li>';
               }
               $('.coll_list1 ul div').html(coll);
           }
       })
    });
    $(function(){
        $('#butRad').click(
           function(){
               /*邮箱*/
               var eMail =/^(\w-*\.*)+@(\w-?)+(\.\w{2,})+$/;
               if($('#email_info').val().length == 0){

               }else if(!eMail.test($("#email_info").val())){
                   document.getElementById("email_info").focus();
                   alert('邮箱格式不正确');
                   return false;
               }
               var myNum = /^((1[3-8]{1})+\d{9})$/;
               if($('#modify').val().length == 0){

               }else if(!myNum.test($("#modify").val())){
                   document.getElementById("modify").focus();
                   alert('手机号格式不正确');
                   return false;
               }
               var _imgSrc = $("#rImg").attr("src");
               if(_imgSrc === ""){
                   alert("请上传头像");
                   return false;
               }
               if($('#texCon').val().length <= 50){
                   document.getElementById("texCon").focus();
                   alert('介绍不少于50个字');
                   return false;
               }else if($('#texCon').val().length > 500){
                   document.getElementById("texCon").focus();
                   alert('介绍在500字以内');
                   return false;
               }
               if($('#cost').val().length == 0){
                   document.getElementById("cost").focus();
                    alert('现出场费用为必填项');
                   return false;
               }
               if($('#newPass').val() == $('#passNum').val()){
               }else{
                   document.getElementById("newPass").focus();
                   $('.prompt_my1 span').replaceWith('<span style="color:#fa424c;">两次密码不一致</span>');
                   return false;
               }
               if($('.other').val().length <= 30){

               }else{
                   alert('其他要求不大于30字');
                   return false;
               }
               var arrs = [];
               if($('#styleList ul li.on').length ==0){
                   alert('歌手风格标签不能为空');
                   return false;
               }else if($('#styleList ul li.on').length <=3 ){
                   var arr = document.getElementById('styleList').getElementsByTagName('li');
                       for(var i = 0,len = arr.length;i<len;i++){
                           if(arr[i].className == 'on'){
                               arrs[arrs.length]=arr[i].value;
                           }
                   }
               }else{
                   alert('歌手风格标签最多只能选择三项');
                   return false;}
               var active = [];
               if($('#typeList ul li.on').length ==0){
                   var list=document.getElementById("typeList");//获取ul对象
                   lis=list.getElementsByTagName("li");//获取ul下的li对象,是数组集合
                   for(var c=0,l=lis.length;c<l;c++){
                       lis[c].className="on";
                       if(lis[c].className="on"){
                           active[active.length]=lis[c].value;
                       }
                   }
               }else{
                   var drr = document.getElementById('typeList').getElementsByTagName('li');
                   for(var r = 0,dlen = drr.length;r<dlen;r++){
                       if(drr[r].className == 'on'){
                           active[active.length]=drr[r].value;
                       }
                   }
               }
               var eat = [];
               var eatId=document.getElementById("eat");
               lis1=eatId.getElementsByTagName("li");
               if($('#eat ul li.on').length ==0){
                   for(var b=0,d=lis1.length;b<d;b++){
                       lis1[b].className="on";
                       if(lis1[b].className="on"){
                           eat[eat.length]=lis1[b].value;
                       }
                   }
               }else{
                   for(var e = 0,elen = lis1.length;e<elen;e++){
                       if(lis1[e].className == 'on'){
                           eat[eat.length]=lis1[e].value;
                       }
                   }
               }
               var live = [];
               lis2 =document.getElementById("hotel").getElementsByTagName("li");
               if($('#hotel ul li.on').length ==0){
                   for(var f = 0,g = lis2.length;f < g;f++){
                       lis2[f].className="on";
                       if(lis2[f].className="on"){
                           live[live.length]=lis2[f].value;
                       }
                   }
               }else{
                   for(var h = 0,j = lis2.length; h < j; h++){
                       if(lis2[h].className == 'on'){
                           live[live.length]=lis2[h].value;
                       }
                   }
               }
               var travel =[];
               lis3 = document.getElementById('car').getElementsByTagName('li');
               if($('#car ul li.on').length == 0){
                   for(var moreCar = 0, carLen = lis3.length; moreCar < carLen; moreCar++){
                       lis3[moreCar].className='on';
                       if(lis3[moreCar].className='on'){
                           travel[travel.length]=lis3[moreCar].value;
                       }
                   }
               }else{
                   for(var carOn =0, carLen1 = lis3.length; carOn < carLen1; carOn++){
                       if(lis3[carOn].className=='on'){
                           travel[travel.length]=lis3[carOn].value;
                       }
                   }
               }
               var opt = document.getElementById("person").value;

               $.ajax({
                   type:'post',
                   url:'../UserInfo/update_user_info?uid='+uid,
                   traditional: true,
                   data:{
                       name : document.getElementById('name').value,
                       gender : $('#gender').val(),
                       phone : document.getElementById('modify').value,
                       email : $('#email_info').val(),
                       home : $('#province').val()+'-'+$('#city').val()+'-'+$('#area').val(),
                       introduction : $('#texCon').val(),
                       'style[]':arrs,
                       'activity[]':active,
                       'meal[]':eat,
                       'hotel[]':live,
                       'traffic[]':travel,
                       img:document.getElementById("rImg").src,
                       price : $('#cost').val(),
                       history_price : $('#history_cost').val(),
                       accompanying:opt,
                       other:$('.other').val(),
                       'user_order_date[]':dangqi
                   },
                   success:function(data){

                   }
               });
               window.location.reload();
           }
        )
    });
</script>
<script type="text/javascript">
    var daarr =[];
    $(document).ready(function(){
        $.ajax({
            type:'get',
            url:'../UserInfo/get_user_info?uid='+uid,
            dataType:'json',
            success:function(data){
                $('#head_img').attr('src',data.results.info.img);
                $('.singerName nobr').html(data.results.info.name);

                $('#name').html(data.results.info.name);
                $('#gender');
                $('#num_phone').html(data.results.info.phone);
                $('#phone a').click(function(){
                    $('#modify').css('display','block');
                });
                $('#butRad').click(function(){
                    $('#modify').css('display','none');
                });
                if(document.getElementById('modify').value==''){
                    $('#modify').css('display','block');
                }
                document.getElementById('name').value=data.results.info.name;
                document.getElementById('modify').value=data.results.info.phone;
                document.getElementById("email_info").value=data.results.info.email;
                $('#rImg').attr('src',data.results.info.img);
                document.getElementById("cost").value=data.results.info.price;
                document.getElementById("history_cost").value=data.results.info.history_price;
                document.getElementById("other_text").value=data.results.info.other;
                var homestr=data.results.info.home;
                var homearr= new Array();
                //console.log(homestr);
                homearr=homestr.split('-');

                new PCAS("province","city","area",homearr[0],homearr[1],homearr[2]);
                var per = data.results.info.accompanying;
                $('#person option').html(per).attr('selected','selected');

                $('#texCon').html(data.results.info.introduction);
                var sty ='';
                for(var w = 0; w < data.results.style.length; w++){
                    var cha = data.results.style[w].selected;
                    if(cha == 'T'){
                        sty +='<li class="on" value="'+data.results.style[w].id+'">'+data.results.style[w].name+'</li>';
                    }else{
                        sty +='<li value="'+data.results.style[w].id+'">'+data.results.style[w].name+'</li>';
                    }
                }
                $('#styleList ul').html(sty);

                var act = '';
                for(var er = 0; er < data.results.activity.length; er++){
                    var che = data.results.activity[er].selected;
                    if(che == 'T'){
                        act +='<li class="on" value="'+data.results.activity[er].id+'">'+data.results.activity[er].name+'</li>';
                    }else{
                        act +='<li value="'+data.results.activity[er].id+'">'+data.results.activity[er].name+'</li>';
                    }
                }
                $('#typeList ul').html(act);

                var eat = '';
                for(var ar = 0; ar < data.results.meal.length; ar++){
                    var chb = data.results.meal[ar].selected;
                    if(chb == 'T'){
                        eat +='<li class="on" value="'+data.results.meal[ar].id+'">'+data.results.meal[ar].name+'</li>';
                    }else{
                        eat +='<li value="'+data.results.meal[ar].id+'">'+data.results.meal[ar].name+'</li>';
                    }
                }
                $('#eat ul').html(eat);

                var hot = '';
                for(var cr = 0; cr < data.results.hotel.length; cr++){
                    var chd = data.results.hotel[cr].selected;
                    if(chd == 'T'){
                        hot+='<li class="on" value="'+data.results.hotel[cr].id+'">'+data.results.hotel[cr].name+'</li>';
                    }else{
                        hot+='<li value="'+data.results.hotel[cr].id+'">'+data.results.hotel[cr].name+'</li>';
                    }
                }
                $('#hotel ul').html(hot);
                var air = '';
                var train = '';
                var trai1 = '';
                var car = '';
                for(var dr = 0; dr < data.results.traffic.length; dr++){
                    var chf = data.results.traffic[dr].id;
                    var chfSe = data.results.traffic[dr].selected;
                    if(chf < 20 && chfSe=='T'){
                        air+='<li class ="on" value="'+chf+'">'+data.results.traffic[dr].name+'</li>';
                    }else if(chf < 20){
                        air+='<li value="'+chf+'">'+data.results.traffic[dr].name+'</li>';
                    }else if(chf<30 && chf>20 && chfSe=='T'){
                        train+='<li class ="on" value="'+chf+'">'+data.results.traffic[dr].name+'</li>';
                    }else if(chf<30 && chf>20){
                        train+='<li value="'+chf+'">'+data.results.traffic[dr].name+'</li>';
                    }else if(chf<40 && chf>30 && chfSe=='T'){
                        trai1+='<li class ="on" value="'+chf+'">'+data.results.traffic[dr].name+'</li>';
                    }else if(chf<40 && chf>30){
                        trai1+='<li value="'+chf+'">'+data.results.traffic[dr].name+'</li>';
                    }else if(chf > 40 && chfSe=='T'){
                        car+='<li class="on" value="'+chf+'">'+data.results.traffic[dr].name+'</li>';
                    }else if(chf > 40){
                        car+='<li value="'+chf+'">'+data.results.traffic[dr].name+'</li>';
                    }
                }
                $('#car ul:first').html('<span style="float:left; width:80px; height:30px; line-height:30px; margin-top:10px; color:#333;">飞机：</span>'+air);
                $('#car ul:eq(1)').html('<span style="float:left; width:80px; height:30px; line-height:30px; margin-top:10px; color:#333;">高铁/客车：</span>'+train);
                $('#car ul:eq(2)').html('<span style="float:left; width:80px; height:30px; line-height:30px; margin-top:10px; color:#333;">普通列车：</span>'+trai1);
                $('#car ul:last').html('<span style="float:left; width:80px; height:30px; line-height:30px; margin-top:10px; color:#333;">汽车：</span>'+car);
                for(var da = 0; da < data.results.user_order_date.length; da++){
                    var daNum = data.results.user_order_date[da].date;
                    daarr[daarr.length]= daNum;
                }
                var att = document.getElementById("dd23");
                dangqi=[];
                Kan=new Kalendae(document.body,{
                    months:2,
                    direction:'future',
                    mode:'multiple',
                    attachTo: att,
                    selected:daarr
                });
                $('.k-days span').click(
                        function(){
                            dangqi =Kan.getSelected().split(",");
                        }
                );

                    $("#styleList ul li").click(function(){
                        if($(this).hasClass("on")){
                            $(this).removeClass("on");
                        }else{
                            $(this).addClass("on");
                        }
                    });

                    $("#typeList ul li").click(function(){
                        if($(this).hasClass("on")){
                            $(this).removeClass("on");
                        }else{
                            $(this).addClass("on");
                        }
                    });

                $("#eat ul li").click(function(){
                    if($(this).hasClass("on")){
                        $(this).removeClass("on");
                    }else{
                        $(this).addClass("on");
                    }
                });
                $("#hotel ul li").click(function(){
                    if($(this).hasClass("on")){
                        $(this).removeClass("on");
                    }else{
                        $(this).addClass("on");
                    }
                });
                $("#car ul li").click(function(){
                    if($(this).hasClass("on")){
                        $(this).removeClass("on");
                    }else{
                        $(this).addClass("on");
                    }
                })
            }
        })

    });
</script>

</body>
</html>
